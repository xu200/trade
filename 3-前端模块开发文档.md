# å‰ç«¯æ¨¡å—å¼€å‘æ–‡æ¡£

## ğŸ“Œ æ¨¡å—æ¦‚è¿°

å‰ç«¯æä¾›ç”¨æˆ·äº¤äº’ç•Œé¢ï¼Œå®ç°ä¸ MetaMask é’±åŒ…çš„è¿æ¥ã€æ™ºèƒ½åˆçº¦çš„è°ƒç”¨ã€ä»¥åŠä¸šåŠ¡æµç¨‹çš„å¯è§†åŒ–å±•ç¤ºã€‚

---

## ğŸ¯ å¼€å‘ç›®æ ‡

- æä¾›ç®€æ´ç¾è§‚çš„ç”¨æˆ·ç•Œé¢
- å®ç° MetaMask é’±åŒ…è¿æ¥å’Œè´¦æˆ·ç®¡ç†
- å°è£…æ™ºèƒ½åˆçº¦è°ƒç”¨é€»è¾‘
- å®ç°åº”æ”¶è´¦æ¬¾çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†
- æä¾›å®æ—¶æ•°æ®æ›´æ–°å’Œäº¤æ˜“çŠ¶æ€è¿½è¸ª

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: React 18+
- **æ„å»ºå·¥å…·**: Vite
- **æ ·å¼**: TailwindCSS + DaisyUI
- **Web3åº“**: ethers.jsï¼ˆä»…ç”¨äºç­¾åéªŒè¯ï¼‰
- **çŠ¶æ€ç®¡ç†**: Zustand
- **è·¯ç”±**: React Router v6
- **HTTPå®¢æˆ·ç«¯**: Axiosï¼ˆä¸»è¦äº¤äº’æ–¹å¼ï¼‰
- **UIç»„ä»¶**: 
  - React Icons
  - React Hot Toast (æ¶ˆæ¯æç¤º)
  - React Loading Skeleton (éª¨æ¶å±)

---

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
frontend/
â”œâ”€â”€ public/
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ assets/              # é™æ€èµ„æº
â”‚   â”œâ”€â”€ components/          # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.jsx
â”‚   â”‚   â”‚   â””â”€â”€ Footer.jsx
â”‚   â”‚   â”œâ”€â”€ Wallet/
â”‚   â”‚   â”‚   â””â”€â”€ WalletConnect.jsx
â”‚   â”‚   â”œâ”€â”€ Receivable/
â”‚   â”‚   â”‚   â”œâ”€â”€ ReceivableCard.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ReceivableList.jsx
â”‚   â”‚   â”‚   â””â”€â”€ ReceivableDetail.jsx
â”‚   â”‚   â”œâ”€â”€ Finance/
â”‚   â”‚   â”‚   â”œâ”€â”€ FinanceApplicationCard.jsx
â”‚   â”‚   â”‚   â””â”€â”€ FinanceApplicationList.jsx
â”‚   â”‚   â””â”€â”€ Common/
â”‚   â”‚       â”œâ”€â”€ Loading.jsx
â”‚   â”‚       â”œâ”€â”€ Modal.jsx
â”‚   â”‚       â””â”€â”€ StatusBadge.jsx
â”‚   â”œâ”€â”€ pages/               # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Dashboard.jsx
â”‚   â”‚   â”œâ”€â”€ CreateReceivable.jsx
â”‚   â”‚   â”œâ”€â”€ ConfirmReceivable.jsx
â”‚   â”‚   â”œâ”€â”€ TransferReceivable.jsx
â”‚   â”‚   â”œâ”€â”€ FinanceApply.jsx
â”‚   â”‚   â”œâ”€â”€ FinanceApprove.jsx
â”‚   â”‚   â””â”€â”€ TransactionHistory.jsx
â”‚   â”œâ”€â”€ services/            # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ authService.js       # è®¤è¯æœåŠ¡ï¼ˆç­¾åç™»å½•ï¼‰
â”‚   â”‚   â”œâ”€â”€ apiService.js        # APIæœåŠ¡ï¼ˆä¸»è¦ï¼‰
â”‚   â”‚   â””â”€â”€ walletService.js     # é’±åŒ…æœåŠ¡ï¼ˆä»…ç­¾åï¼‰
â”‚   â”œâ”€â”€ store/               # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ walletStore.js
â”‚   â”‚   â”œâ”€â”€ receivableStore.js
â”‚   â”‚   â””â”€â”€ financeStore.js
â”‚   â”œâ”€â”€ hooks/               # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ useWallet.js
â”‚   â”‚   â”œâ”€â”€ useContract.js
â”‚   â”‚   â””â”€â”€ useReceivables.js
â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ formatters.js
â”‚   â”‚   â”œâ”€â”€ validators.js
â”‚   â”‚   â””â”€â”€ constants.js
â”‚   â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ contract.js
â”‚   â”œâ”€â”€ App.jsx              # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ main.jsx             # ä¸»æ–‡ä»¶
â”‚   â””â”€â”€ index.css            # å…¨å±€æ ·å¼
â”œâ”€â”€ .env.example
â”œâ”€â”€ vite.config.js
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. API æœåŠ¡ (services/apiService.js)

**æ ¸å¿ƒæœåŠ¡ï¼šå‰ç«¯é€šè¿‡HTTP APIä¸åç«¯äº¤äº’ï¼Œä¸ç›´æ¥è°ƒç”¨æ™ºèƒ½åˆçº¦**

```javascript
import axios from 'axios';

const API_BASE_URL = import.meta.env.VITE_API_URL;

class ApiService {
  constructor() {
    this.client = axios.create({
      baseURL: API_BASE_URL,
      timeout: 30000
    });

    // è¯·æ±‚æ‹¦æˆªå™¨ï¼šæ·»åŠ  Token
    this.client.interceptors.request.use(config => {
      const token = localStorage.getItem('token');
      if (token) {
        config.headers.Authorization = `Bearer ${token}`;
      }
      return config;
    });

    // å“åº”æ‹¦æˆªå™¨ï¼šç»Ÿä¸€é”™è¯¯å¤„ç†
    this.client.interceptors.response.use(
      response => response.data,
      error => {
        if (error.response?.status === 401) {
          localStorage.removeItem('token');
          window.location.href = '/login';
        }
        return Promise.reject(error);
      }
    );
  }

  // ========== è®¤è¯ç›¸å…³ ==========
  
  async login(address, signature, message) {
    const data = await this.client.post('/api/auth/login', {
      address,
      signature,
      message
    });
    if (data.success) {
      localStorage.setItem('token', data.data.token);
    }
    return data;
  }

  async register(userData) {
    const data = await this.client.post('/api/auth/register', userData);
    return data;
  }

  async getCurrentUser() {
    const data = await this.client.get('/api/auth/me');
    return data;
  }

  // ========== åº”æ”¶è´¦æ¬¾ç›¸å…³ ==========
  
  async getReceivables(params) {
    const data = await this.client.get('/api/receivables', { params });
    return data;
  }

  async getReceivableDetail(id) {
    const data = await this.client.get(`/api/receivables/${id}`);
    return data;
  }

  async createReceivable(receivableData) {
    const data = await this.client.post('/api/receivables', receivableData);
    return data;
  }

  async confirmReceivable(id) {
    const data = await this.client.post(`/api/receivables/${id}/confirm`);
    return data;
  }

  async transferReceivable(id, newOwner) {
    const data = await this.client.post(`/api/receivables/${id}/transfer`, {
      newOwner
    });
    return data;
  }

  // ========== èèµ„ç›¸å…³ ==========
  
  async getFinanceApplications(params) {
    const data = await this.client.get('/api/finance/applications', { params });
    return data;
  }

  async applyForFinance(applicationData) {
    const data = await this.client.post('/api/finance/apply', applicationData);
    return data;
  }

  async approveFinance(appId, approved) {
    const data = await this.client.post(`/api/finance/${appId}/approve`, {
      approved
    });
    return data;
  }

  // ========== ç»Ÿè®¡ç›¸å…³ ==========
  
  async getDashboardStats() {
    const data = await this.client.get('/api/stats/dashboard');
    return data;
  }

  async getTransactionHistory(params) {
    const data = await this.client.get('/api/transactions', { params });
    return data;
  }
}

export default new ApiService();
```

### 2. è®¤è¯æœåŠ¡ (services/authService.js)

**MetaMaskä»…ç”¨äºç­¾åéªŒè¯èº«ä»½ï¼Œä¸ç”¨äºäº¤æ˜“**

```javascript
import { ethers } from 'ethers';
import apiService from './apiService';

class AuthService {
  // æ£€æŸ¥ MetaMask æ˜¯å¦å®‰è£…
  isMetaMaskInstalled() {
    return typeof window.ethereum !== 'undefined';
  }

  // ç™»å½•ï¼ˆé€šè¿‡ç­¾åéªŒè¯èº«ä»½ï¼‰
  async login() {
    if (!this.isMetaMaskInstalled()) {
      throw new Error('è¯·å®‰è£… MetaMask é’±åŒ…');
    }

    try {
      // 1. è¿æ¥é’±åŒ…è·å–åœ°å€
      const provider = new ethers.BrowserProvider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      const signer = await provider.getSigner();
      const address = await signer.getAddress();

      // 2. ç”Ÿæˆç™»å½•æ¶ˆæ¯
      const timestamp = new Date().toISOString();
      const message = `ç™»å½•åˆ°ä¾›åº”é“¾é‡‘èç³»ç»Ÿ\nåœ°å€: ${address}\næ—¶é—´: ${timestamp}`;

      // 3. è¯·æ±‚ç”¨æˆ·ç­¾åï¼ˆä»…ç”¨äºèº«ä»½éªŒè¯ï¼‰
      const signature = await signer.signMessage(message);

      // 4. å‘é€åˆ°åç«¯éªŒè¯å¹¶è·å– Token
      const result = await apiService.login(address, signature, message);

      if (result.success) {
        // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
        localStorage.setItem('userAddress', address);
        return {
          address,
          userInfo: result.data.userInfo
        };
      } else {
        throw new Error(result.message || 'ç™»å½•å¤±è´¥');
      }
    } catch (error) {
      console.error('ç™»å½•å¤±è´¥:', error);
      throw error;
    }
  }

  // æ³¨å†Œ
  async register(role, companyName, contactPerson, contactEmail) {
    if (!this.isMetaMaskInstalled()) {
      throw new Error('è¯·å®‰è£… MetaMask é’±åŒ…');
    }

    try {
      const provider = new ethers.BrowserProvider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      const signer = await provider.getSigner();
      const address = await signer.getAddress();

      const result = await apiService.register({
        address,
        role,
        companyName,
        contactPerson,
        contactEmail
      });

      return result;
    } catch (error) {
      console.error('æ³¨å†Œå¤±è´¥:', error);
      throw error;
    }
  }

  // ç™»å‡º
  logout() {
    localStorage.removeItem('token');
    localStorage.removeItem('userAddress');
  }

  // æ£€æŸ¥æ˜¯å¦ç™»å½•
  isAuthenticated() {
    return !!localStorage.getItem('token');
  }

  // è·å–å½“å‰ç”¨æˆ·åœ°å€
  getCurrentAddress() {
    return localStorage.getItem('userAddress');
  }

  // ç›‘å¬è´¦æˆ·å˜åŒ–
  watchAccountChange(callback) {
    if (window.ethereum) {
      window.ethereum.on('accountsChanged', (accounts) => {
        if (accounts.length === 0) {
          this.logout();
          callback(null);
        } else {
          // è´¦æˆ·å˜åŒ–æ—¶éœ€è¦é‡æ–°ç™»å½•
          this.logout();
          window.location.reload();
        }
      });
    }
  }
}

export default new AuthService();
```

### 3. é’±åŒ…çŠ¶æ€ç®¡ç† (store/walletStore.js)

```javascript
import { ethers } from 'ethers';
import web3Service from './web3Service';
import contractABI from '../contracts/SupplyChainFinance.json';

const CONTRACT_ADDRESS = import.meta.env.VITE_CONTRACT_ADDRESS;

class ContractService {
  constructor() {
    this.contract = null;
  }

  // åˆå§‹åŒ–åˆçº¦å®ä¾‹
  async initContract() {
    if (!web3Service.signer) {
      throw new Error('è¯·å…ˆè¿æ¥é’±åŒ…');
    }

    this.contract = new ethers.Contract(
      CONTRACT_ADDRESS,
      contractABI.abi,
      web3Service.signer
    );

    return this.contract;
  }

  // è·å–åªè¯»åˆçº¦å®ä¾‹
  getReadOnlyContract() {
    const provider = new ethers.JsonRpcProvider(import.meta.env.VITE_RPC_URL);
    return new ethers.Contract(CONTRACT_ADDRESS, contractABI.abi, provider);
  }

  // ========== ç”¨æˆ·ç›¸å…³ ==========

  // æ³¨å†Œç”¨æˆ·
  async registerUser(role, name) {
    await this.initContract();
    const tx = await this.contract.registerUser(role, name);
    return await tx.wait();
  }

  // è·å–ç”¨æˆ·è§’è‰²
  async getUserRole(address) {
    const contract = this.getReadOnlyContract();
    return await contract.getUserRole(address);
  }

  // ========== åº”æ”¶è´¦æ¬¾ç›¸å…³ ==========

  // åˆ›å»ºåº”æ”¶è´¦æ¬¾
  async createReceivable(supplier, amount, dueTime, description, contractNumber) {
    await this.initContract();
    
    const amountWei = ethers.parseEther(amount.toString());
    const dueTimestamp = Math.floor(new Date(dueTime).getTime() / 1000);

    const tx = await this.contract.createReceivable(
      supplier,
      amountWei,
      dueTimestamp,
      description,
      contractNumber
    );

    return await tx.wait();
  }

  // ç¡®è®¤åº”æ”¶è´¦æ¬¾
  async confirmReceivable(id) {
    await this.initContract();
    const tx = await this.contract.confirmReceivable(id);
    return await tx.wait();
  }

  // è½¬è®©åº”æ”¶è´¦æ¬¾
  async transferReceivable(id, newOwner) {
    await this.initContract();
    const tx = await this.contract.transferReceivable(id, newOwner);
    return await tx.wait();
  }

  // è·å–åº”æ”¶è´¦æ¬¾è¯¦æƒ…
  async getReceivable(id) {
    const contract = this.getReadOnlyContract();
    const receivable = await contract.getReceivable(id);
    
    return {
      id: receivable.id.toString(),
      issuer: receivable.issuer,
      owner: receivable.owner,
      supplier: receivable.supplier,
      amount: ethers.formatEther(receivable.amount),
      createTime: new Date(Number(receivable.createTime) * 1000),
      dueTime: new Date(Number(receivable.dueTime) * 1000),
      confirmed: receivable.confirmed,
      financed: receivable.financed,
      settled: receivable.settled,
      description: receivable.description,
      contractNumber: receivable.contractNumber
    };
  }

  // è·å–ç”¨æˆ·æ‹¥æœ‰çš„åº”æ”¶è´¦æ¬¾
  async getReceivablesByOwner(address) {
    const contract = this.getReadOnlyContract();
    const ids = await contract.getReceivablesByOwner(address);
    return ids.map(id => id.toString());
  }

  // è·å–ç”¨æˆ·å‘è¡Œçš„åº”æ”¶è´¦æ¬¾
  async getReceivablesByIssuer(address) {
    const contract = this.getReadOnlyContract();
    const ids = await contract.getReceivablesByIssuer(address);
    return ids.map(id => id.toString());
  }

  // ========== èèµ„ç›¸å…³ ==========

  // ç”³è¯·èèµ„
  async applyForFinance(receivableId, financier, financeAmount, interestRate) {
    await this.initContract();
    
    const amountWei = ethers.parseEther(financeAmount.toString());

    const tx = await this.contract.applyForFinance(
      receivableId,
      financier,
      amountWei,
      interestRate
    );

    return await tx.wait();
  }

  // å®¡æ‰¹èèµ„ç”³è¯·
  async approveFinanceApplication(appId, approve) {
    await this.initContract();
    const tx = await this.contract.approveFinanceApplication(appId, approve);
    return await tx.wait();
  }

  // è·å–èèµ„ç”³è¯·è¯¦æƒ…
  async getFinanceApplication(appId) {
    const contract = this.getReadOnlyContract();
    const app = await contract.getFinanceApplication(appId);
    
    return {
      receivableId: app.receivableId.toString(),
      applicant: app.applicant,
      financier: app.financier,
      applyTime: new Date(Number(app.applyTime) * 1000),
      financeAmount: ethers.formatEther(app.financeAmount),
      interestRate: app.interestRate.toString(),
      approved: app.approved,
      processed: app.processed
    };
  }

  // ========== äº‹ä»¶ç›‘å¬ ==========

  // ç›‘å¬åº”æ”¶è´¦æ¬¾åˆ›å»ºäº‹ä»¶
  onReceivableCreated(callback) {
    const contract = this.getReadOnlyContract();
    contract.on('ReceivableCreated', (id, issuer, supplier, amount, event) => {
      callback({
        id: id.toString(),
        issuer,
        supplier,
        amount: ethers.formatEther(amount),
        event
      });
    });
  }

  // ç›‘å¬åº”æ”¶è´¦æ¬¾ç¡®è®¤äº‹ä»¶
  onReceivableConfirmed(callback) {
    const contract = this.getReadOnlyContract();
    contract.on('ReceivableConfirmed', (id, confirmer, event) => {
      callback({
        id: id.toString(),
        confirmer,
        event
      });
    });
  }

  // ç›‘å¬åº”æ”¶è´¦æ¬¾è½¬è®©äº‹ä»¶
  onReceivableTransferred(callback) {
    const contract = this.getReadOnlyContract();
    contract.on('ReceivableTransferred', (id, from, to, event) => {
      callback({
        id: id.toString(),
        from,
        to,
        event
      });
    });
  }
}

export default new ContractService();
```

### 3. é’±åŒ…çŠ¶æ€ç®¡ç† (store/walletStore.js)

```javascript
import { create } from 'zustand';
import web3Service from '../services/web3Service';
import contractService from '../services/contractService';

export const useWalletStore = create((set, get) => ({
  // çŠ¶æ€
  account: null,
  balance: '0',
  network: null,
  userRole: 0,
  userName: '',
  isConnected: false,
  isLoading: false,

  // è¿æ¥é’±åŒ…
  connectWallet: async () => {
    set({ isLoading: true });
    try {
      const { account } = await web3Service.connectWallet();
      const balance = await web3Service.getBalance(account);
      const network = await web3Service.getNetwork();
      const userRole = await contractService.getUserRole(account);

      set({
        account,
        balance,
        network: network.name,
        userRole: Number(userRole),
        isConnected: true,
        isLoading: false
      });

      return true;
    } catch (error) {
      console.error('è¿æ¥é’±åŒ…å¤±è´¥:', error);
      set({ isLoading: false });
      return false;
    }
  },

  // æ–­å¼€è¿æ¥
  disconnect: () => {
    web3Service.disconnect();
    set({
      account: null,
      balance: '0',
      network: null,
      userRole: 0,
      userName: '',
      isConnected: false
    });
  },

  // æ›´æ–°ä½™é¢
  updateBalance: async () => {
    const { account } = get();
    if (account) {
      const balance = await web3Service.getBalance(account);
      set({ balance });
    }
  },

  // æ³¨å†Œç”¨æˆ·
  registerUser: async (role, name) => {
    try {
      await contractService.registerUser(role, name);
      set({ userRole: role, userName: name });
      return true;
    } catch (error) {
      console.error('æ³¨å†Œå¤±è´¥:', error);
      return false;
    }
  }
}));
```

### 4. åº”æ”¶è´¦æ¬¾çŠ¶æ€ç®¡ç† (store/receivableStore.js)

```javascript
import { create } from 'zustand';
import contractService from '../services/contractService';
import apiService from '../services/apiService';

export const useReceivableStore = create((set, get) => ({
  // çŠ¶æ€
  receivables: [],
  currentReceivable: null,
  isLoading: false,

  // è·å–åº”æ”¶è´¦æ¬¾åˆ—è¡¨
  fetchReceivables: async (address, type = 'owner') => {
    set({ isLoading: true });
    try {
      let ids;
      if (type === 'owner') {
        ids = await contractService.getReceivablesByOwner(address);
      } else {
        ids = await contractService.getReceivablesByIssuer(address);
      }

      const receivables = await Promise.all(
        ids.map(id => contractService.getReceivable(id))
      );

      set({ receivables, isLoading: false });
      return receivables;
    } catch (error) {
      console.error('è·å–åº”æ”¶è´¦æ¬¾å¤±è´¥:', error);
      set({ isLoading: false });
      return [];
    }
  },

  // è·å–åº”æ”¶è´¦æ¬¾è¯¦æƒ…
  fetchReceivableDetail: async (id) => {
    set({ isLoading: true });
    try {
      const receivable = await contractService.getReceivable(id);
      set({ currentReceivable: receivable, isLoading: false });
      return receivable;
    } catch (error) {
      console.error('è·å–åº”æ”¶è´¦æ¬¾è¯¦æƒ…å¤±è´¥:', error);
      set({ isLoading: false });
      return null;
    }
  },

  // åˆ›å»ºåº”æ”¶è´¦æ¬¾
  createReceivable: async (data) => {
    try {
      const receipt = await contractService.createReceivable(
        data.supplier,
        data.amount,
        data.dueTime,
        data.description,
        data.contractNumber
      );
      return receipt;
    } catch (error) {
      console.error('åˆ›å»ºåº”æ”¶è´¦æ¬¾å¤±è´¥:', error);
      throw error;
    }
  },

  // ç¡®è®¤åº”æ”¶è´¦æ¬¾
  confirmReceivable: async (id) => {
    try {
      const receipt = await contractService.confirmReceivable(id);
      // æ›´æ–°æœ¬åœ°çŠ¶æ€
      const { receivables } = get();
      const updated = receivables.map(r => 
        r.id === id ? { ...r, confirmed: true } : r
      );
      set({ receivables: updated });
      return receipt;
    } catch (error) {
      console.error('ç¡®è®¤åº”æ”¶è´¦æ¬¾å¤±è´¥:', error);
      throw error;
    }
  },

  // è½¬è®©åº”æ”¶è´¦æ¬¾
  transferReceivable: async (id, newOwner) => {
    try {
      const receipt = await contractService.transferReceivable(id, newOwner);
      // æ›´æ–°æœ¬åœ°çŠ¶æ€
      const { receivables } = get();
      const updated = receivables.map(r => 
        r.id === id ? { ...r, owner: newOwner } : r
      );
      set({ receivables: updated });
      return receipt;
    } catch (error) {
      console.error('è½¬è®©åº”æ”¶è´¦æ¬¾å¤±è´¥:', error);
      throw error;
    }
  }
}));
```

### 5. Dashboard é¡µé¢ (pages/Dashboard.jsx)

```jsx
import React, { useEffect, useState } from 'react';
import { useWalletStore } from '../store/walletStore';
import { useReceivableStore } from '../store/receivableStore';
import ReceivableCard from '../components/Receivable/ReceivableCard';
import { FaWallet, FaFileInvoiceDollar, FaCheckCircle, FaMoneyBillWave } from 'react-icons/fa';

const Dashboard = () => {
  const { account, balance, userRole } = useWalletStore();
  const { receivables, fetchReceivables, isLoading } = useReceivableStore();
  const [stats, setStats] = useState({
    total: 0,
    confirmed: 0,
    financed: 0,
    totalAmount: 0
  });

  useEffect(() => {
    if (account) {
      loadData();
    }
  }, [account]);

  useEffect(() => {
    if (receivables.length > 0) {
      calculateStats();
    }
  }, [receivables]);

  const loadData = async () => {
    await fetchReceivables(account, 'owner');
  };

  const calculateStats = () => {
    const total = receivables.length;
    const confirmed = receivables.filter(r => r.confirmed).length;
    const financed = receivables.filter(r => r.financed).length;
    const totalAmount = receivables.reduce((sum, r) => sum + parseFloat(r.amount), 0);

    setStats({ total, confirmed, financed, totalAmount });
  };

  const getRoleName = (role) => {
    const roles = ['æœªæ³¨å†Œ', 'æ ¸å¿ƒä¼ä¸š', 'ä¾›åº”å•†', 'é‡‘èæœºæ„'];
    return roles[role] || 'æœªçŸ¥';
  };

  return (
    <div className="container mx-auto px-4 py-8">
      {/* ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ */}
      <div className="bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg shadow-lg p-6 text-white mb-8">
        <h2 className="text-2xl font-bold mb-4">æ¬¢è¿å›æ¥ï¼</h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <p className="text-sm opacity-90">é’±åŒ…åœ°å€</p>
            <p className="font-mono text-sm">{account?.slice(0, 10)}...{account?.slice(-8)}</p>
          </div>
          <div>
            <p className="text-sm opacity-90">è´¦æˆ·ä½™é¢</p>
            <p className="text-xl font-bold">{parseFloat(balance).toFixed(4)} ETH</p>
          </div>
          <div>
            <p className="text-sm opacity-90">ç”¨æˆ·è§’è‰²</p>
            <p className="text-xl font-bold">{getRoleName(userRole)}</p>
          </div>
        </div>
      </div>

      {/* ç»Ÿè®¡å¡ç‰‡ */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-lg shadow p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-gray-500 text-sm">æ€»åº”æ”¶è´¦æ¬¾</p>
              <p className="text-2xl font-bold text-gray-800">{stats.total}</p>
            </div>
            <FaFileInvoiceDollar className="text-4xl text-blue-500" />
          </div>
        </div>

        <div className="bg-white rounded-lg shadow p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-gray-500 text-sm">å·²ç¡®è®¤</p>
              <p className="text-2xl font-bold text-gray-800">{stats.confirmed}</p>
            </div>
            <FaCheckCircle className="text-4xl text-green-500" />
          </div>
        </div>

        <div className="bg-white rounded-lg shadow p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-gray-500 text-sm">å·²èèµ„</p>
              <p className="text-2xl font-bold text-gray-800">{stats.financed}</p>
            </div>
            <FaMoneyBillWave className="text-4xl text-purple-500" />
          </div>
        </div>

        <div className="bg-white rounded-lg shadow p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-gray-500 text-sm">æ€»é‡‘é¢</p>
              <p className="text-2xl font-bold text-gray-800">{stats.totalAmount.toFixed(2)}</p>
            </div>
            <FaWallet className="text-4xl text-orange-500" />
          </div>
        </div>
      </div>

      {/* åº”æ”¶è´¦æ¬¾åˆ—è¡¨ */}
      <div className="bg-white rounded-lg shadow">
        <div className="p-6 border-b">
          <h3 className="text-xl font-bold text-gray-800">æˆ‘çš„åº”æ”¶è´¦æ¬¾</h3>
        </div>
        <div className="p-6">
          {isLoading ? (
            <div className="text-center py-8">
              <div className="loading loading-spinner loading-lg"></div>
              <p className="mt-4 text-gray-500">åŠ è½½ä¸­...</p>
            </div>
          ) : receivables.length === 0 ? (
            <div className="text-center py-8">
              <p className="text-gray-500">æš‚æ— åº”æ”¶è´¦æ¬¾</p>
            </div>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {receivables.map(receivable => (
                <ReceivableCard key={receivable.id} receivable={receivable} />
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default Dashboard;
```

### 6. åˆ›å»ºåº”æ”¶è´¦æ¬¾é¡µé¢ (pages/CreateReceivable.jsx)

```jsx
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { useReceivableStore } from '../store/receivableStore';
import toast from 'react-hot-toast';
import { ethers } from 'ethers';

const CreateReceivable = () => {
  const navigate = useNavigate();
  const { createReceivable } = useReceivableStore();
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [formData, setFormData] = useState({
    supplier: '',
    amount: '',
    dueTime: '',
    description: '',
    contractNumber: ''
  });

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();

    // è¡¨å•éªŒè¯
    if (!ethers.isAddress(formData.supplier)) {
      toast.error('æ— æ•ˆçš„ä¾›åº”å•†åœ°å€');
      return;
    }

    if (parseFloat(formData.amount) <= 0) {
      toast.error('é‡‘é¢å¿…é¡»å¤§äº0');
      return;
    }

    if (new Date(formData.dueTime) <= new Date()) {
      toast.error('åˆ°æœŸæ—¶é—´å¿…é¡»åœ¨æœªæ¥');
      return;
    }

    setIsSubmitting(true);
    const loadingToast = toast.loading('æ­£åœ¨åˆ›å»ºåº”æ”¶è´¦æ¬¾...');

    try {
      const receipt = await createReceivable(formData);
      toast.success('åº”æ”¶è´¦æ¬¾åˆ›å»ºæˆåŠŸï¼', { id: loadingToast });
      navigate('/dashboard');
    } catch (error) {
      console.error('åˆ›å»ºå¤±è´¥:', error);
      toast.error(error.message || 'åˆ›å»ºå¤±è´¥ï¼Œè¯·é‡è¯•', { id: loadingToast });
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <div className="container mx-auto px-4 py-8">
      <div className="max-w-2xl mx-auto">
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h2 className="text-2xl font-bold text-gray-800 mb-6">åˆ›å»ºåº”æ”¶è´¦æ¬¾</h2>

          <form onSubmit={handleSubmit} className="space-y-6">
            {/* ä¾›åº”å•†åœ°å€ */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                ä¾›åº”å•†é’±åŒ…åœ°å€ *
              </label>
              <input
                type="text"
                name="supplier"
                value={formData.supplier}
                onChange={handleChange}
                placeholder="0x..."
                className="input input-bordered w-full"
                required
              />
            </div>

            {/* é‡‘é¢ */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                é‡‘é¢ (ETH) *
              </label>
              <input
                type="number"
                name="amount"
                value={formData.amount}
                onChange={handleChange}
                placeholder="0.00"
                step="0.01"
                min="0"
                className="input input-bordered w-full"
                required
              />
            </div>

            {/* åˆ°æœŸæ—¶é—´ */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                åˆ°æœŸæ—¶é—´ *
              </label>
              <input
                type="datetime-local"
                name="dueTime"
                value={formData.dueTime}
                onChange={handleChange}
                className="input input-bordered w-full"
                required
              />
            </div>

            {/* åˆåŒç¼–å· */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                åˆåŒç¼–å· *
              </label>
              <input
                type="text"
                name="contractNumber"
                value={formData.contractNumber}
                onChange={handleChange}
                placeholder="CONTRACT-001"
                className="input input-bordered w-full"
                required
              />
            </div>

            {/* æè¿° */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                æè¿° *
              </label>
              <textarea
                name="description"
                value={formData.description}
                onChange={handleChange}
                placeholder="è¯·è¾“å…¥åº”æ”¶è´¦æ¬¾æè¿°..."
                rows="4"
                className="textarea textarea-bordered w-full"
                required
              />
            </div>

            {/* æŒ‰é’®ç»„ */}
            <div className="flex gap-4">
              <button
                type="submit"
                disabled={isSubmitting}
                className="btn btn-primary flex-1"
              >
                {isSubmitting ? 'åˆ›å»ºä¸­...' : 'åˆ›å»ºåº”æ”¶è´¦æ¬¾'}
              </button>
              <button
                type="button"
                onClick={() => navigate('/dashboard')}
                className="btn btn-ghost"
              >
                å–æ¶ˆ
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
};

export default CreateReceivable;
```

---

## ğŸ¨ æ ·å¼é…ç½®

### tailwind.config.js

```javascript
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [require("daisyui")],
  daisyui: {
    themes: ["light", "dark", "cupcake"],
  },
}
```

### vite.config.js

```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:5000',
        changeOrigin: true
      }
    }
  }
})
```

---

## ğŸ“ å¼€å‘æ­¥éª¤

1. **åˆå§‹åŒ–é¡¹ç›®** (15åˆ†é’Ÿ)
   ```bash
   npm create vite@latest frontend -- --template react
   cd frontend
   npm install
   npm install ethers zustand react-router-dom axios
   npm install -D tailwindcss daisyui postcss autoprefixer
   npx tailwindcss init -p
   ```

2. **é…ç½® TailwindCSS** (10åˆ†é’Ÿ)

3. **åˆ›å»ºé¡¹ç›®ç»“æ„** (15åˆ†é’Ÿ)

4. **å®ç° Web3 æœåŠ¡** (1å°æ—¶)

5. **å®ç°çŠ¶æ€ç®¡ç†** (1å°æ—¶)

6. **å¼€å‘é¡µé¢ç»„ä»¶** (3-4å°æ—¶)
   - Dashboard
   - CreateReceivable
   - ConfirmReceivable
   - TransferReceivable
   - FinanceApply
   - FinanceApprove

7. **å¼€å‘å…¬å…±ç»„ä»¶** (1.5å°æ—¶)

8. **é…ç½®è·¯ç”±** (30åˆ†é’Ÿ)

9. **æµ‹è¯•å’Œè°ƒè¯•** (1å°æ—¶)

**é¢„è®¡æ€»æ—¶é—´ï¼š8-10å°æ—¶**

---

## ğŸ äº¤ä»˜ç‰©

- [x] å®Œæ•´çš„ React å‰ç«¯é¡¹ç›®
- [x] é’±åŒ…è¿æ¥åŠŸèƒ½
- [x] æ‰€æœ‰ä¸šåŠ¡é¡µé¢
- [x] å“åº”å¼è®¾è®¡
- [x] é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€
- [x] ç”¨æˆ·å‹å¥½çš„äº¤äº’æç¤º

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **MetaMask æ£€æµ‹**: å¯åŠ¨æ—¶æ£€æŸ¥æ˜¯å¦å®‰è£… MetaMask
2. **ç½‘ç»œåˆ‡æ¢**: æç¤ºç”¨æˆ·åˆ‡æ¢åˆ°æ­£ç¡®çš„ç½‘ç»œ
3. **äº¤æ˜“ç¡®è®¤**: ç­‰å¾…äº¤æ˜“ç¡®è®¤åæ›´æ–° UI
4. **é”™è¯¯å¤„ç†**: å‹å¥½çš„é”™è¯¯æç¤ºä¿¡æ¯
5. **åŠ è½½çŠ¶æ€**: æ‰€æœ‰å¼‚æ­¥æ“ä½œéƒ½è¦æ˜¾ç¤ºåŠ è½½çŠ¶æ€
6. **å“åº”å¼è®¾è®¡**: é€‚é…ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯

---

## ğŸ”— ç›¸å…³èµ„æº

- React: https://react.dev
- Vite: https://vitejs.dev
- TailwindCSS: https://tailwindcss.com
- DaisyUI: https://daisyui.com
- Zustand: https://zustand-demo.pmnd.rs
- ethers.js: https://docs.ethers.org

