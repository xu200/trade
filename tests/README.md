# 测试说明

## API 自动化测试

### 环境要求

```bash
pip install requests
```

### 使用方法

1. 确保后端服务已启动：
```bash
cd backend
npm start
```

2. 确保数据库已创建并配置好

3. 确保智能合约已部署并配置了合约地址

4. 运行测试脚本：
```bash
python tests/test_api.py
```

### 测试内容

- ✅ 健康检查
- ✅ 用户注册（核心企业、供应商、金融机构）
- ⚠️ 用户登录（需要真实签名，测试脚本使用模拟数据）
- ✅ 创建应收账款
- ✅ 获取应收账款列表
- ⚠️ 确认应收账款（需要智能合约支持）
- ⚠️ 融资申请（需要智能合约支持）

### 注意事项

1. **登录测试**：由于需要 MetaMask 签名，测试脚本使用的是模拟签名，实际会失败。真实环境需要使用真实的签名。

2. **智能合约调用**：涉及智能合约的测试（创建、确认、转让、融资等）需要：
   - 合约已部署
   - 后端配置了正确的合约地址和私钥
   - 区块链网络正常运行

3. **数据库**：确保 MySQL 数据库已创建并运行

### 测试流程

完整的业务流程测试：

1. 核心企业注册并登录
2. 供应商注册并登录
3. 金融机构注册并登录
4. 核心企业创建应收账款
5. 供应商确认应收账款
6. 供应商申请融资
7. 金融机构审批融资
8. 供应商转让应收账款

### 手动测试

如果自动化测试失败，可以使用 Postman 或 curl 进行手动测试：

```bash
# 健康检查
curl http://localhost:5000/health

# 注册用户
curl -X POST http://localhost:5000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "address": "0x...",
    "role": "core_company",
    "companyName": "测试公司"
  }'
```

### 测试数据

测试脚本使用的测试地址（Hardhat 默认账户）：
- 核心企业: `0x70997970C51812dc3A010C7d01b50e0d17dc79C8`
- 供应商: `0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC`
- 金融机构: `0x90F79bf6EB2c4f870365E785982E1f101E93b906`

