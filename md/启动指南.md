# 🚀 项目启动指南

## 📋 前置要求

### 必需软件
- ✅ Node.js 18+ (已安装)
- ✅ MySQL 8.0+ (需要安装)
- ⚠️ Python 3.x (用于测试，已安装)

### 可选软件
- MetaMask 浏览器扩展（前端使用）
- Hardhat（智能合约开发）

---

## 🗄️ 第一步：配置数据库

### 1. 安装 MySQL

如果还没有安装 MySQL，请下载安装：
- Windows: https://dev.mysql.com/downloads/installer/
- 或使用 XAMPP/WAMP

### 2. 创建数据库

```bash
# 登录 MySQL
mysql -u root -p

# 创建数据库
CREATE DATABASE supplychain_finance CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 退出
exit
```

### 3. 导入表结构

```bash
mysql -u root -p supplychain_finance < database/schema.sql
```

或者在 MySQL 命令行中：
```sql
USE supplychain_finance;
SOURCE F:/code/trade/trade/database/schema.sql;
```

---

## ⚙️ 第二步：配置后端

### 1. 配置环境变量

后端目录下已有 `.env` 文件，请根据实际情况修改：

```bash
cd backend
# 编辑 .env 文件，主要修改数据库密码
```

重点配置项：
- `DB_PASSWORD`: 你的 MySQL 密码
- `JWT_SECRET`: 建议改成复杂的随机字符串

### 2. 测试数据库连接

```bash
cd backend
node -e "const sequelize = require('./src/config/database'); sequelize.authenticate().then(() => console.log('✅ 数据库连接成功')).catch(err => console.error('❌ 数据库连接失败:', err));"
```

---

## 🚀 第三步：启动后端服务

### 启动服务

```bash
cd backend
npm start
```

你应该看到：
```
✅ 数据库连接成功
✅ 数据库模型同步完成
⚠️  未配置合约地址，跳过数据同步
🚀 服务器运行在 http://localhost:5000
```

### 验证服务

打开浏览器访问：
- http://localhost:5000/health

应该返回：
```json
{"status":"ok","message":"Server is running"}
```

---

## 🧪 第四步：运行测试

### 1. 安装测试依赖

```bash
pip install requests
```

### 2. 运行API测试

```bash
python tests/test_api.py
```

### 预期结果

由于没有部署智能合约，涉及区块链的测试会失败，但基础API应该可以访问：
- ✅ 健康检查 - 通过
- ❌ 用户注册 - 失败（需要合约）
- ❌ 其他测试 - 失败（需要合约）

---

## 📝 第五步：部署智能合约（可选）

### 1. 安装正确的 Node.js 版本

智能合约需要 Node.js 22+：
```bash
# 使用 nvm 切换版本
nvm install 22
nvm use 22
```

### 2. 启动本地区块链

```bash
cd contracts
npx hardhat node
```

这会启动一个本地以太坊网络，并显示10个测试账户。

### 3. 部署合约（新终端）

```bash
cd contracts
npx hardhat run scripts/deploy.js --network localhost
```

部署成功后会显示合约地址，复制这个地址。

### 4. 更新后端配置

编辑 `backend/.env`：
```bash
CONTRACT_ADDRESS=0x5FbDB2315678afecb367f032d93F642f64180aa3  # 你的合约地址
PRIVATE_KEY=0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80  # Hardhat账户0的私钥
```

### 5. 重启后端

```bash
cd backend
npm start
```

现在应该看到：
```
✅ 数据库连接成功
✅ 数据库模型同步完成
启动区块链数据同步服务...
开始监听合约事件...
🚀 服务器运行在 http://localhost:5000
```

---

## 🎨 第六步：启动前端（待开发）

前端还在开发中，完成后的启动方式：

```bash
cd frontend
npm install
npm run dev
```

---

## 📊 当前项目状态

### ✅ 已完成
- 智能合约（Solidity）
- 数据库设计（MySQL）
- 后端API（Node.js + Express）
- 测试脚本（Python）

### ⏳ 待完成
- 前端界面（React + Vite）
- 完整的端到端测试

---

## 🐛 常见问题

### 1. 数据库连接失败

**错误**: `Access denied for user 'root'@'localhost'`

**解决**: 检查 `.env` 文件中的数据库密码是否正确

### 2. 端口被占用

**错误**: `EADDRINUSE: address already in use :::5000`

**解决**: 
```bash
# Windows
netstat -ano | findstr :5000
taskkill /PID <PID> /F

# 或修改 .env 中的 PORT
```

### 3. 合约调用失败

**错误**: `合约ABI未加载`

**解决**: 
1. 确保已部署合约
2. 确保 `CONTRACT_ADDRESS` 已配置
3. 确保 `SupplyChainFinance.json` 文件存在于项目根目录

### 4. Node.js 版本不兼容

**错误**: `Node.js version not supported`

**解决**: 
- 后端可以使用 Node.js 16+
- 智能合约需要 Node.js 22+
- 使用 nvm 管理多个版本

---

## 📞 获取帮助

如果遇到问题：
1. 查看日志输出
2. 检查 `.env` 配置
3. 确认数据库和服务都在运行
4. 查看项目文档

---

**祝使用愉快！🎉**



