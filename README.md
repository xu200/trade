
# 🏦 区块链供应链金融系统

一个基于区块链技术的供应链金融平台，实现应收账款的确权、转让和融资全流程管理。

---

## 📋 项目概述

本系统采用**后端中心化架构**，利用区块链的不可篡改和可追溯特性，为供应链上下游企业提供透明、高效的金融服务。

### 核心特点

- ✅ **后端为核心**：前端通过API操作，后端统一与区块链交互
- ✅ **用户体验好**：类似传统Web应用，无需频繁确认交易
- ✅ **Gas费用低**：后端托管账户，用户无需支付Gas费
- ✅ **权限控制**：基于JWT的身份认证和角色权限管理
- ✅ **数据优化**：后端缓存链上数据，查询速度快
- ✅ **业务完整**：支持确权→转让→融资完整闭环

---

## 🏗️ 系统架构

```
┌─────────────────────────────────────────┐
│         前端 (React + Vite)              │
│  - 用户界面和交互                         │
│  - MetaMask 签名登录（身份验证）           │
│  - 通过 HTTP API 与后端通信               │
└─────────────┬───────────────────────────┘
              │ HTTP API (REST)
              │ 不直接调用智能合约
┌─────────────▼───────────────────────────┐
│      后端 (Node.js + Express)            │
│  ✅ 统一的业务逻辑处理                    │
│  ✅ JWT 认证和权限控制                    │
│  ✅ 与智能合约交互（代理）                 │
│  ✅ 数据缓存和查询优化                    │
│  ✅ 交易管理和状态追踪                    │
└─────────────┬───────────────────────────┘
              │ Web3 RPC
              │ 后端托管账户
┌─────────────▼───────────────────────────┐
│    智能合约 (Solidity + Hardhat)         │
│  - 应收账款确权                          │
│  - 债权转让记录                          │
│  - 融资状态管理                          │
│  - 不可篡改的交易记录                    │
└─────────────┬───────────────────────────┘
              │
┌─────────────▼───────────────────────────┐
│    数据库 (MySQL)                        │
│  - 用户信息                              │
│  - 应收账款索引                          │
│  - 交易历史                              │
│  - 统计数据                              │
└─────────────────────────────────────────┘
```

---

## 🎯 核心功能

### 1. 用户角色管理
- **核心企业**：创建应收账款、结算
- **供应商**：确认应收账款、申请融资、转让债权
- **金融机构**：审批融资申请

### 2. 应收账款管理
- 创建应收账款凭证
- 供应商确认凭证
- 债权转让
- 应收账款结算

### 3. 融资服务
- 供应商发起融资申请
- 金融机构审核
- 融资状态追踪

### 4. 数据查询
- 应收账款列表和详情
- 交易历史记录
- 统计报表

---

## 💻 技术栈

### 智能合约
- **语言**: Solidity ^0.8.0
- **框架**: Hardhat
- **测试**: Hardhat Test + Chai
- **网络**: 本地测试网 / Sepolia

### 后端
- **运行环境**: Node.js 18+
- **Web框架**: Express.js
- **数据库**: MySQL 8.0
- **ORM**: Sequelize
- **Web3**: ethers.js
- **认证**: JWT (jsonwebtoken)

### 前端
- **框架**: React 18+
- **构建工具**: Vite
- **样式**: TailwindCSS + DaisyUI
- **状态管理**: Zustand
- **路由**: React Router v6
- **HTTP客户端**: Axios
- **Web3**: ethers.js（仅用于签名）

---

## 📂 项目结构

```
supplychain-finance/
├── contracts/                    # 智能合约模块
│   ├── contracts/
│   │   └── SupplyChainFinance.sol
│   ├── scripts/
│   │   └── deploy.js
│   ├── test/
│   │   └── SupplyChainFinance.test.js
│   └── hardhat.config.js
│
├── backend/                      # 后端模块
│   ├── src/
│   │   ├── config/              # 配置文件
│   │   ├── models/              # 数据模型
│   │   ├── controllers/         # 控制器
│   │   ├── services/            # 服务层
│   │   ├── routes/              # 路由
│   │   ├── middleware/          # 中间件
│   │   └── app.js               # 入口文件
│   └── .env
│
├── frontend/                     # 前端模块
│   ├── src/
│   │   ├── components/          # 组件
│   │   ├── pages/               # 页面
│   │   ├── services/            # 服务层
│   │   ├── store/               # 状态管理
│   │   └── App.jsx
│   └── .env
│
├── database/                     # 数据库脚本
│   └── schema.sql
│
├── docs/                         # 文档
│   ├── 1-智能合约模块开发文档.md
│   ├── 2-后端模块开发文档.md
│   ├── 3-前端模块开发文档.md
│   ├── 架构优化方案.md
│   └── 高效开发方案.md
│
└── README.md
```

---

## 🚀 快速开始

### 环境要求

- Node.js >= 18.0
- MySQL >= 8.0
- MetaMask 浏览器扩展

### 1. 克隆项目

```bash
git clone <repository-url>
cd supplychain-finance
```

### 2. 智能合约部署

```bash
cd contracts
npm install
npx hardhat compile
npx hardhat test

# 启动本地区块链
npx hardhat node

# 部署合约（新终端）
npx hardhat run scripts/deploy.js --network localhost
```

### 3. 数据库初始化

```bash
# 创建数据库
mysql -u root -p
CREATE DATABASE supplychain_finance;

# 导入表结构
mysql -u root -p supplychain_finance < database/schema.sql
```

### 4. 后端启动

```bash
cd backend
npm install

# 配置环境变量
cp .env.example .env
# 编辑 .env 文件，填入合约地址、数据库配置等

# 启动服务
npm run dev
```

**访问 API 文档**：
- Swagger UI: http://localhost:5000/api-docs
- 健康检查: http://localhost:5000/health

详细使用说明请查看 [backend/SWAGGER_GUIDE.md](backend/SWAGGER_GUIDE.md)

### 5. 前端启动

```bash
cd frontend
npm install

# 配置环境变量
cp .env.example .env
# 编辑 .env 文件，填入API地址、合约地址等

# 启动开发服务器
npm run dev
```

### 6. 访问应用

打开浏览器访问 `http://localhost:3000`

---

## 🔑 关键设计说明

### 为什么采用后端中心化架构？

#### ❌ 原方案问题（前端直接调用合约）
1. 用户需要支付所有 Gas 费用
2. 每次操作都需要 MetaMask 确认，体验差
3. 无法做复杂的业务逻辑控制
4. 查询链上数据慢
5. 前端暴露私钥风险

#### ✅ 优化后方案（后端代理）
1. **用户体验好**：类似传统Web应用，无需频繁确认
2. **Gas费用低**：后端托管账户统一支付
3. **业务控制强**：后端可以做权限验证、数据校验
4. **查询速度快**：后端缓存数据，直接查数据库
5. **安全性高**：私钥由后端管理，不暴露给前端

### MetaMask 的作用

在优化后的架构中，MetaMask **仅用于身份验证**：

1. 用户连接 MetaMask 获取地址
2. 用户签名一条消息证明身份
3. 后端验证签名，颁发 JWT Token
4. 后续所有操作使用 Token 认证

**不用于交易签名**，所有交易由后端统一提交。

### 适用场景

这种架构特别适合：
- ✅ 企业内部供应链金融系统
- ✅ 联盟链应用
- ✅ 需要控制用户权限的场景
- ✅ 希望提供传统Web应用体验的项目

---

## 📊 开发进度

### 预计开发时间：2-3天

| 模块 | 时间 | 状态 |
|------|------|------|
| 智能合约 | 3-4小时 | ⏳ 待开发 |
| 后端API | 4-5小时 | ⏳ 待开发 |
| 前端界面 | 8-10小时 | ⏳ 待开发 |
| 集成测试 | 2-3小时 | ⏳ 待开发 |

详见 [高效开发方案.md](docs/高效开发方案.md)

---

## 📖 文档

- [智能合约模块开发文档](docs/1-智能合约模块开发文档.md)
- [后端模块开发文档](docs/2-后端模块开发文档.md)
- [前端模块开发文档](docs/3-前端模块开发文档.md)
- [架构优化方案](docs/架构优化方案.md)
- [高效开发方案](docs/高效开发方案.md)

---

## 🔒 安全注意事项

1. **私钥管理**：后端私钥通过环境变量管理，不提交到Git
2. **JWT密钥**：使用强随机字符串作为JWT_SECRET
3. **数据库安全**：使用参数化查询，防止SQL注入
4. **API安全**：所有接口都要进行身份认证和权限验证
5. **合约审计**：上线前进行专业的智能合约安全审计

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

---

## 📄 许可证

MIT License

---

## 📞 联系方式

如有问题，请提交 Issue 或联系开发团队。

---

**祝开发顺利！🎉**
